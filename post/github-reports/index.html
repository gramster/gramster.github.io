<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Graham Wheeler's Random Forest"><meta property="og:type" content="article"><meta property="og:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta property="twitter:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta name=title content="Github reports for backlog management"><meta property="og:title" content="Github reports for backlog management"><meta property="twitter:title" content="Github reports for backlog management"><meta name=description content="Thoughts on technology, management and math by Graham Wheeler"><meta property="og:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:card" content="summary"><meta name=keyword content="Management, Psychology, Data Science, Mathematics, Software Engineering"><link rel="shortcut icon" href=/img/favicon.ico><title>Github reports for backlog management-Graham Wheeler's Random Forest</title><link rel=canonical href=/post/github-reports/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Graham Wheeler's Random Forest</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/top/books/>BOOKS</a></li><li><a href=/top/archive/>ARCHIVE</a></li><li><a href=/top/about/>ABOUT</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/forest.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Github reports for backlog management</h1><h2 class=subheading></h2><span class=meta>Posted by
Graham Wheeler
on
Sunday, May 1, 2022</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>A couple of years ago we decided we wanted to make sure that we were responding timeously to issues that users created on our GitHub repos. In particular, a 3-business day SLA was what we thought would be appropriate. Making sure that we did that day after day could be a bit tedious, so I thought it made sense to automate it.</p><p>We had a vast trove of GitHub data in our Kusto data warehouse for every repository owned by Microsoft. It was possible to run Kusto queries and send e-mail using our low-code/no-code Power Apps platform, so I spent some time writing the queries and getting this all set up, and it worked great.</p><p>Unfortunately, a few months later, the team that maintained all the GitHub data in Kusto decided to change the schema and migrate it all over to new tables. And even worse for my use case, they weren&rsquo;t going to migrate everything (I think it was a lot of data and not a lot of people were using it the way I was). This meant a key query I needed, which got the members of the team responsible for maintaining a repo (including past members who may have moved on, perhaps even leaving Microsoft), would no longer work. I had other things keeping me busy, and decided not to fix this system. But I missed the insights it gave.</p><p>More recently, we started accumulating a lot of old issues in <a href="https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance">Pylance</a>, and because it has been a rapidly evolving product, the cost of investigating these old issues was non-trivial but not always worthwhile. So I thought it might be time to bring back my reports, but to do it in a way that was easier for others to leverage. In particular, I didn&rsquo;t want to take a dependency on the data warehouse.</p><p>I now have this working, and in this post will describe how I am doing it, and show how you can leverage this yourself if you find it useful. Let me start by sharing a typical report (note: &ldquo;OP&rdquo; stands for &ldquo;original poster&rdquo;; I essentially distinguish between the original poster, my team members, and everyone else (&ldquo;third party&rdquo;)):</p><p><img src=/img/github-report.png alt></p><p>You&rsquo;ll notice that I first distinguish between issues marked as bugs and those not; I think this is a useful separation. There are then several further subsections:</p><ul><li>Issues that need a response from team:</li><li>Issues that have comments from OP after last team response</li><li>Issues that have comments from 3rd party after last team response</li><li>Issues that have no external responses since team response in 30+ days (the actual number of days is configureable):</li></ul><p>There&rsquo;s also two variants of these reports: full reports (that get run once a week) and daily incremental reports (showing only those issues that have changed status in the past day).</p><p>These reports get generated automatically by GitHub actions and committed to a repo; I name them with the day of the week so I have a 7-day rolling window effectively. The repo where this happens is <a href=https://github.com/gramster/python-reports>here</a></p><p>There are several components to the system:</p><ul><li>there is a GitHub workflow for each report, that runs on a schedule. This needs to be configured withe the repo, the access token, and the type of report, as well as an optional batch size which can be useful in rare cases where issues have many events that cause the query responses to be too large;</li><li>the workflows in turn each make use of a GitHub action, which is still largely specific to my use case, but adds additional settings that are common across all my reports; for example, it specifies all the GitHub user names of people in my team, and adds the <code>microsoft/</code> organizational part of the repository path. This action is mostly just me following DRY (don&rsquo;t repeat yourself) principles;</li><li>that GitHub action in turn makes use of a generic GitHub action, which is what you would make use of if you customised this yourself; this action requires a full set of input parameters and makes very few assumptions about the inputs beyond having some default values;</li><li>that action then leverages a utility <code>ghreport</code> written in Python that queries GitHub APIs for the repo specified at the start and using the initially passed-in access token, and generates the reports in Markdown format (it supports HTML format too, in which case it can include a chart of bug rates over time, but for the purposes of having automated reports comitted to a GitHub repo that are easy to read, Markdown makes more sense).</li></ul><p>We&rsquo;ll go through each of these in turn. I should note that in my day to day job I am a manager of managers and don&rsquo;t normally get to write GitHub actions; this was my first time, so there may be things I am doing inefficiently or non-idiomatically. I welcome feedback.</p><h2 id=the-python-utility-ghreport>The Python Utility <code>ghreport</code></h2><p>Below I&rsquo;ll dive into a few pieces of the code.</p><h3 id=get-the-team-members>Get the Team Members</h3><p>In the reports, we want to distinguish between team members and non-members. One way to do this is to find who can push to the repo, or administer the repo. This is not public knowledge (i.e. you can&rsquo;t see this for repos you don&rsquo;t own), so does require you to have elevated permissions.</p><p>In the end, for my reports, I don&rsquo;t use this; it uses up my API quota, uses the REST APIs so is slow, and doesn&rsquo;t include people who have left the team. I added a way to override or augment the users that this function retrieves, and I leverage that. But if you don&rsquo;t know who is in the team, this is a good way to get an initial list.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_members</span>(owner:<span style=color:#8be9fd;font-style:italic>str</span>, repo:<span style=color:#8be9fd;font-style:italic>str</span>, token:<span style=color:#8be9fd;font-style:italic>str</span>) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>set</span>:
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    Get the team members for a repo that have push or admin rights.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>	This is not public so if you are not in such a team (probably with admin rights) this will fail.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    I haven&#39;t found a good way to use the GraphQL API for this so still uses REST API.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    g <span style=color:#ff79c6>=</span> Github(token)
</span></span><span style=display:flex><span>    ghrepo <span style=color:#ff79c6>=</span> g<span style=color:#ff79c6>.</span>get_repo(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>{</span>owner<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/</span><span style=color:#f1fa8c>{</span>repo<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>    rtn <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>set</span>()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> team <span style=color:#ff79c6>in</span> ghrepo<span style=color:#ff79c6>.</span>get_teams():
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> team<span style=color:#ff79c6>.</span>permission <span style=color:#ff79c6>not</span> <span style=color:#ff79c6>in</span> [<span style=color:#f1fa8c>&#34;push&#34;</span>, <span style=color:#f1fa8c>&#34;admin&#34;</span>]:
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>continue</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>for</span> member <span style=color:#ff79c6>in</span> team<span style=color:#ff79c6>.</span>get_members():
</span></span><span style=display:flex><span>                    rtn<span style=color:#ff79c6>.</span>add(member<span style=color:#ff79c6>.</span>login)
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>except</span> Exception:
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>pass</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>except</span> Exception:
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;Couldn&#39;t get teams for repo </span><span style=color:#f1fa8c>{</span>owner<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/</span><span style=color:#f1fa8c>{</span>repo<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> rtn
</span></span></code></pre></div><h3 id=getting-open-issues-and-their-events>Getting Open Issues and their Events</h3><p>The key piece to getting the data is the GraphQL query. An earlier version of my code used the REST API, but it is very ineffecient and requires many calls to get all the necessary data; with the API rate limiting that happens it can take hours to get all the data necessary. In contrast, the GraphQL approach takes only a few queries and can be done in minutes if not seconds.</p><p>I&rsquo;m not going to explain how to use GraphQL here; there are plenty of references for that. Suffice it to say that in our query, we want to get all the open issues for a repo, and for each issue we want the number, title, timestamp when created, original author, and the subsequent timeline events if they are label, unlabel, or comment events. We need the label events to distinguish bugs from other issues, and for the comment events we want to know who commented and when. We limit to 100 timeline events which should be enough for most issues, while we get pagination continuation for the issues themselves in case they can&rsquo;t be retrieved in a single call. The key subset of the query is :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-graphql data-lang=graphql><span style=display:flex><span>repository(owner: <span style=color:#8be9fd;font-style:italic>$owner</span>, <span style=color:#50fa7b>name</span>: <span style=color:#8be9fd;font-style:italic>$repo</span>) {
</span></span><span style=display:flex><span>  <span style=color:#50fa7b>issues</span>(states: [<span style=color:#50fa7b>OPEN</span>], first: <span style=color:#8be9fd;font-style:italic>$chunk</span>, <span style=color:#50fa7b>after</span>: <span style=color:#8be9fd;font-style:italic>$cursor</span>) {
</span></span><span style=display:flex><span>    <span style=color:#50fa7b>totalCount</span>
</span></span><span style=display:flex><span>    pageInfo {
</span></span><span style=display:flex><span>      endCursor
</span></span><span style=display:flex><span>      hasNextPage
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    nodes {
</span></span><span style=display:flex><span>      number
</span></span><span style=display:flex><span>      title
</span></span><span style=display:flex><span>      createdAt
</span></span><span style=display:flex><span>	  closedAt
</span></span><span style=display:flex><span>      author {
</span></span><span style=display:flex><span>        login
</span></span><span style=display:flex><span>	  }
</span></span><span style=display:flex><span>      timelineItems(
</span></span><span style=display:flex><span>        first: <span style=color:#50fa7b>100</span>
</span></span><span style=display:flex><span>        itemTypes: [<span style=color:#50fa7b>LABELED_EVENT</span>, UNLABELED_EVENT, ISSUE_COMMENT])
</span></span><span style=display:flex><span>	  {
</span></span><span style=display:flex><span>	    <span style=color:#8be9fd;font-style:italic>...</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}		
</span></span></code></pre></div><p>(We&rsquo;re also getting timestamp when closed; that is historical as an earlier version didn&rsquo;t filter the results to only open issues).</p><p>In order to run this query, I use the Gidgethub Python package (named after Brett Cannon&rsquo;s cat Gidget). Having fetched the data from GitHub, I turn it into a list of dataclass instances:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>@dataclass
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Event</span>:
</span></span><span style=display:flex><span>    when: datetime
</span></span><span style=display:flex><span>    actor: <span style=color:#8be9fd;font-style:italic>str</span>
</span></span><span style=display:flex><span>    event: <span style=color:#8be9fd;font-style:italic>str</span>
</span></span><span style=display:flex><span>    arg: <span style=color:#8be9fd;font-style:italic>str</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@dataclass
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Issue</span>:
</span></span><span style=display:flex><span>    number: <span style=color:#8be9fd;font-style:italic>int</span>
</span></span><span style=display:flex><span>    title: <span style=color:#8be9fd;font-style:italic>str</span>
</span></span><span style=display:flex><span>    created_by: <span style=color:#8be9fd;font-style:italic>str</span>
</span></span><span style=display:flex><span>    created_at: datetime
</span></span><span style=display:flex><span>    closed_at: datetime
</span></span><span style=display:flex><span>    first_team_response_at: datetime <span style=color:#6272a4># first comment by team</span>
</span></span><span style=display:flex><span>    last_team_response_at: datetime <span style=color:#6272a4># last comment by team</span>
</span></span><span style=display:flex><span>    last_op_response_at: datetime <span style=color:#6272a4># last comment by OP</span>
</span></span><span style=display:flex><span>    last_response_at: datetime <span style=color:#6272a4># last comment by anyone</span>
</span></span><span style=display:flex><span>    events: List[Event]
</span></span><span style=display:flex><span>    is_bug: <span style=color:#8be9fd;font-style:italic>bool</span>
</span></span></code></pre></div><p>Generating the reports once we have this data is fairly straighforward.</p><h2 id=the-generic-github-action>The Generic GitHub Action</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6272a4># yaml-language-server: $schema=https://json.schemastore.org/github-action.json</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;github-issue-reporter&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Generates reports (typically daily) of potentially stale issues or issues that need attention.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>inputs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>repository</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;The GitHub repository to generate the report for.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: $GITHUB_REPOSITORY
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>githubToken</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;The Github token or PAT token (preferred) for API access.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>reportPath</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Path of report folder&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#34;reports&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>reportNameTemplate</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;File name template for reports. Can use metacharacters understood by Python strftime.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#34;report-%a.md&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>team</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Comma-separated list of team members. Start with + if this is comprehensive.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#39;&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>days</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Time window (in days) for reports. Used to determine what items are new since last report.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#39;1&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>count</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Batch size for Github API call; reduce if action is timing out during API calls.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#39;25&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>all</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Whether to show all items or only those that are new (based on time window).&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>branch</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;The branch to use for pushing the reports to.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#39;main&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>runs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>using</span>: <span style=color:#f1fa8c>&#34;composite&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Check out code
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: actions/checkout@v2
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>persist-credentials</span>: <span style=color:#ff79c6>false</span> <span style=color:#6272a4># otherwise, the token used is the GITHUB_TOKEN, instead of your personal access token.</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>ref</span>: ${{ inputs.branch }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>fetch-depth</span>: <span style=color:#bd93f9>0</span> <span style=color:#6272a4># otherwise, there would be errors pushing refs to the destination repository.</span>
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Setup Python
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: actions/setup-python@v2
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>python-version</span>: <span style=color:#f1fa8c>&#34;3.9&#34;</span>
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Cache pip
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: actions/cache@v2
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>path</span>: ~/.cache/pip
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>key</span>: ${{ runner.os }}-pip-${{ hashFiles(&#39;**/requirements.txt&#39;) }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>restore-keys</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>          </span>          ${{ runner.os }}-pip-
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Install reporter
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>:
</span></span><span style=display:flex><span>        python -m pip install ghreport
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: bash
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Ensure directory exists
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>:
</span></span><span style=display:flex><span>        mkdir -p ${{ inputs.reportPath }}
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: bash
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Generate full report
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span>: inputs.all == &#39;true&#39;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>:
</span></span><span style=display:flex><span>        ghreport -a -n ${{ inputs.count }} -o ${{ inputs.reportPath }}/${{ inputs.reportNameTemplate }} -t ${{ inputs.team }} -d ${{ inputs.days }} ${{ inputs.repository }} ${{ inputs.githubToken }}
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: bash
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Generate limited report
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span>: inputs.all != &#39;true&#39;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>:
</span></span><span style=display:flex><span>        ghreport -n ${{ inputs.count }} -o ${{ inputs.reportPath }}/${{ inputs.reportNameTemplate }} -t ${{ inputs.team }} -d ${{ inputs.days }} ${{ inputs.repository }} ${{ inputs.githubToken }}
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: bash
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Commit report
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>id</span>: commit
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        git config --local user.email &#34;action@github.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        git config --local user.name &#34;github-actions&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        git pull
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        git add -A
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        git commit -m &#34;Daily report update&#34; -a</span>        
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: bash
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Push changes
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: ad-m/github-push-action@master
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>github_token</span>: ${{ inputs.githubToken }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>branch</span>: ${{ inputs.branch }}
</span></span></code></pre></div><p>The steps here are quite long but pretty straightforward: check out the code (of this reports repository), install Python, install ghreport, make sure the report output directory exists in case this is a first run, generate the daily or weekly report as appropriate, commit it locally, and push the changes back. Many of these steps rely on official or 3rd party GitHub actions to do the stated work. I mostly figured out what to do here by doing Internet searches for &ldquo;how do I &lt;x> in GitHub actions?&rdquo; and copy/pasted answers that I customized. If there are better ways of doing any of these steps I would be happy to hear about them.</p><h2 id=the-python-team-github-action>The Python Team GitHub Action</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#6272a4># yaml-language-server: $schema=https://json.schemastore.org/github-action.json</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#34;python-reports&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Generates reports for Python team.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>inputs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>repository</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;The GitHub repository to generate the report for.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>githubToken</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;The Github token or PAT token (preferred) for API access.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>weekly</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Whether to generate a weekly report (else daily).&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>count</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>description</span>: <span style=color:#f1fa8c>&#34;Batch size for calls to Github API. Use if jobs are failing due to timeouts.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>required</span>: <span style=color:#ff79c6>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>default</span>: <span style=color:#f1fa8c>&#39;25&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>runs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>using</span>: <span style=color:#f1fa8c>&#34;composite&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Set environment
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>run</span>: |<span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        echo &#34;TEAM=&#39;gramster&#39;&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        echo -n &#34;REPO=&#39;microsoft/&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        echo -n ${{ inputs.repository }} &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        echo &#34;&#39;&#34; &gt;&gt; $GITHUB_ENV</span>        
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>shell</span>: bash
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Generate full report
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span>: inputs.weekly == &#39;true&#39;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: gramster/github-issue-reporter@main
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>repository</span>: ${{ env.REPO }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>githubToken</span>: ${{ inputs.githubToken }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>reportNameTemplate</span>: <span style=color:#f1fa8c>&#39;fullreport.md&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>reportPath</span>: ${{ inputs.repository }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>all</span>: <span style=color:#ff79c6>true</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>team</span>: ${{ env.TEAM }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>count</span>: ${{ inputs.count }}
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>name</span>: Generate limited report
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span>: inputs.weekly != &#39;true&#39;
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>uses</span>: gramster/github-issue-reporter@main
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>repository</span>: ${{ env.REPO }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>githubToken</span>: ${{ inputs.githubToken }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>reportPath</span>: ${{ inputs.repository }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>team</span>: ${{ env.TEAM }}
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>count</span>: ${{ inputs.count }}
</span></span></code></pre></div><p>(I removed the full comma-separated list of team members and just left my name on line 26. It&rsquo;s possible to use <code>ghreport</code> to get the team members if the token provided is from a user with admin rights, but that won&rsquo;t get ex-team members and slows down the report generation process; providing an explicit list is a better option as the list changes rarely).</p><p>The main inputs are the personal access token, repository name, and type of report. It&rsquo;s also possible to reduce the batch size used by <code>ghreport</code>, but I havent found that necessary.</p><p>The first step generates a script to set the environment as a way of passing parameters to further steps. If I remember correctly, I did this because I wanted to prepend &lsquo;microsoft/&rsquo; to the repository name and didn&rsquo;t know a different way to concatenate strings, but I don&rsquo;t remember exactly; it may be this step is overkill and could be simplified;</p><p>The next two steps are conditional based on the report type; the first handles weekly reports while the second handles daily reports. The main difference is that the weekly report overrides the default property values in the next step for the <code>all</code> and <code>reportNameTemplate</code> properties.</p><h2 id=the-workflows>The Workflows</h2><p>Finally, we have on GitHub workflow for each report, in the <code>.github/workflows</code> folder of the repository. For example, here is the workflow for the Pylance daily report, that I showed an example of at the beginning:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>name</span>: <span style=color:#f1fa8c>&#39;Generate Daily Report for pylance&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>schedule</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ff79c6>cron</span>: <span style=color:#bd93f9>30</span> <span style=color:#bd93f9>7</span> * * *    
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>workflow_dispatch</span>:
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#ff79c6>permissions</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>issues</span>: read
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>contents</span>: write
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>report</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>runs-on</span>: ubuntu-18.04
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>timeout-minutes</span>: <span style=color:#bd93f9>10</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ff79c6>id</span>: report
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>uses</span>: gramster/python-reports@main
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>repository</span>: <span style=color:#f1fa8c>&#39;pylance-release&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ff79c6>githubToken</span>: ${{ secrets.PAT }}
</span></span></code></pre></div><p>This is pretty straightforward now; mostly I just need to give permissions to read issues and commit PRs, specify when the action should run (7:30am daily), and specify the repository and the token. The token could have been factored out and accessed directly in the previous step as I use the same token for each report so am repeating myself, but its a minor annoyance.</p><h2 id=customizing-this-for-your-use>Customizing this for your use</h2><p>If you wanted to make use of this on your own repo(s), I think the approach would vary based on whether you have just one repo or multiple. If you have multiple, I would suggest starting with creating a version of the &lsquo;Python Team Github Action&rsquo; tailored to your organization, and then create workflows similar to mine above that use that. If you have just a single repo, that might be overkill, and you could just create a workflow that inlines steps from the &lsquo;Python Team Github Action&rsquo; customized for your repo.</p><h2 id=whats-next>What&rsquo;s Next?</h2><p>These reports replicate just one part of prior automations and analyses I had. I also have quite a bit of code I wrote to do things like making sure we are following proper issue lifetime procedures, checking how well we are doing in terms of estimating issue time, monitoring bug rates (a feature already in ghreport if you generate HTML output), lead and cycle times, and so on. These all stem back to a period when we used ZenHub for project management, which we don&rsquo;t anymore. I need to rewrite some of the code to play nicely with GitHub projects. Watch this space.</p><hr><ul class=pager><li class=previous><a href=/post/moving-to-hugo/ data-toggle=tooltip data-placement=top title="Moving my blog to Hugo">&larr;
Previous Post</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>SECTIONS</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/data-science title=data-science>data-science</a>
<a href=/tags/jupyter title=jupyter>jupyter</a>
<a href=/tags/management title=management>management</a>
<a href=/tags/pandas title=pandas>pandas</a>
<a href=/tags/programming title=programming>programming</a>
<a href=/tags/psychology title=psychology>psychology</a>
<a href=/tags/python title=python>python</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://snarky.ca/author/brett/>Brett Cannon</a></li><li><a target=_blank href=http://journal.stuffwithstuff.com/>Bob Nystrom</a></li></ul></section></div></div></div></article><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=https://utteranc.es/client.js repo=gramster/gramster.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target=_blank href=https://github.com/gramster><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/grahamwheeler><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/968133><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Graham Wheeler's Random Forest"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Graham Wheeler's Random Forest 2022<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(i,t){var n=document,s="script",e=n.createElement(s),o=n.getElementsByTagName(s)[0];e.src=i,t&&e.addEventListener("load",function(e){t(null,e)},!1),o.parentNode.insertBefore(e,o)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(''),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>