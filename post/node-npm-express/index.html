<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Graham Wheeler's Random Forest"><meta property="og:type" content="article"><meta property="og:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta property="twitter:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta name=title content="Node, npm and Express"><meta property="og:title" content="Node, npm and Express"><meta property="twitter:title" content="Node, npm and Express"><meta name=description content="Thoughts on technology, management and math by Graham Wheeler"><meta property="og:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:card" content="summary"><meta name=keyword content="Management, Psychology, Data Science, Mathematics, Software Engineering"><link rel="shortcut icon" href=/img/favicon.ico><title>Node, npm and Express-Graham Wheeler's Random Forest</title><link rel=canonical href=/post/node-npm-express/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Graham Wheeler's Random Forest</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/top/books/>BOOKS</a></li><li><a href=/top/archive/>ARCHIVE</a></li><li><a href=/top/about/>ABOUT</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/forest.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Node, npm and Express</h1><h2 class=subheading></h2><span class=meta>Posted by
Graham Wheeler
on
Monday, October 26, 2015</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Things have been slow on the blogging front but there has been progress on the
Zite replacement. I&rsquo;ll write more about that soon but part of what I have been
doing is looking into what server-side technology to use.</p><p>As far as a database goes, this seems like a no-brainer. I&rsquo;m dealing with JSON
documents that I can either spend some effort on normalizing to put into a SQL
database, or simply keep them as is and put them in a database that supports
that form, and the obvious choice then is <a href=https://www.mongodb.org/>MongoDB</a>,
which uses a binary form of JSON.</p><p>As for what to use to handle network requests, there I am torn between
<a href=http://www.tornadoweb.org/en/stable/>Tornado</a>
(which is Python) and <a href=https://nodejs.org/en/>Node.js</a> (Javascript). I&rsquo;m not
a big fan of Javascript
(despite having implemented Javascript compilers and virtual machines twice in
my life!), primarily because it relies too much on sneaky tricks to do things
like encapsulation and OOP, but it certainly is the closest to a first-class
language for MongoDB, so I&rsquo;m doing the investigation. I&rsquo;ve had a small amount
of exposure to Node.js at work but mostly as a user, not developer, so what
follows are some of my initial notes on the topic of Node.js, the npm package
manager, and the Express web framework. I hope you find them useful if these
are new to you.</p><h1 id=nodejs>Node.js</h1><p>Node is a version of Chrome&rsquo;s v8 Javascript engine
which includes a set of useful packages for server-side code (event-driven networking,
file system etc) and a package manager, npm. Node was motivated by the need to handle
large numbers of simultaneous sockets for HTTP long polling and web sockets; using
separate threads or processes for each socket is too costly in resources (especially
memory). Instead it uses the JS event loop and closure callbacks to scale efficiently.
The underlying non-blocking socket code is written in C and wrapped in JS.</p><h1 id=commonjs>CommonJS</h1><p>CommonJS is a suite of standardized APIs for using Javascript on the server,
addresses namespacing among other things. For the latter it includes three key
components:</p><ul><li>require() method used to load a module</li><li>exports object to expose code</li><li>module object</li></ul><p>Each module is a single JS file with isolated scope overridden by the exports object.
E.g. consider a file hello.js:</p><pre><code>#!javascript
var message = 'Hello';
exports.sayHello = function() {
    console.log(message);
}
</code></pre><p>which can then be used like:</p><pre><code>#!javascript
var hello = require('./hello');
hello.sayHello();
</code></pre><p>Alternatively we could have written:</p><pre><code>#!javascript
module.exports = function() {
    console.log('Hello');
}
</code></pre><p>and used:</p><pre><code>#!javascript
var hello = require('./hello');
hello();
</code></pre><h1 id=node-core-modules>Node core modules</h1><p>Core modules are compiled into the node binary, and include &lsquo;fs&rsquo; for file
system access, and &lsquo;http&rsquo; for network support. They still need to be loaded
with require(). See <a href=http://nodejs.org/api>http://nodejs.org/api/</a>
for more about the core modules.</p><h1 id=npm---the-node-package-manager>npm - The node package manager</h1><p>npm can install packages and their dependencies locally (in ./node_modules)
or globally with the -g option (in /usr/local/lib/node_modules). You would
typically install common build tools like grunt globally, and dependencies
for a project locally.</p><p>Note that dependencies are not installed at the top-level but within the
package directory. So if you do &rsquo;npm install express&rsquo; then express&rsquo;s
dependencies will be installed in ./node_modules/express/node_modules directory.</p><p>You can specify package@version if you need a specific version. See
<a href=https://github/com/isaacs/node-semver>https://github/com/isaacs/node-semver</a>
for details on semantic versioning names.</p><p>Use &rsquo;npm uninstall&rsquo; to remove a package (include -g for global packages), and
&rsquo;npm update&rsquo; to update a package.</p><p>For multiple packages use a package.json file, with (at least) &ldquo;name&rdquo;, &ldquo;version&rdquo;
and &ldquo;dependencies&rdquo; entries. Use &ldquo;npm init&rdquo; to create a skeleton package.json.
Then use &ldquo;npm install&rdquo;/&ldquo;npm update&rdquo; to install/update all dependencies specified
in the file. You can use &ldquo;npm install <package>â€”save&rdquo; to install a new package
and add it to package.json at the same time.</p><p>To use modules, use require(). If you just specify a name, node will first look
in the core modules folder, then the node_modules/module folder. Alternatively
you can specify an absolute or relative path (the .js extension is not needed).
You can load an entire folder with a single require() if that folder has a
package.json file (the &ldquo;main&rdquo; module will be returned from require()).</p><h1 id=the-connect-module>The Connect module</h1><p>The Connect module builds on top of the http module, and allows the chaining of
request handlers (e.g. for logging, static file handling, etc). Each handler
has three arguments:</p><ul><li>req - the request object</li><li>res - the response object</li><li>next - the next handler in the chain</li></ul><p>Here is a simple server:</p><pre><code>#!javascript
var connect = require('connect');
var app = connect();

var logger = function(req, res, next) {
    console.log(req.method, req.url);
    next();  // chain to next handler
}
var helloWorld = function(req, res, next) {
    res.setHeader('Content-Type', 'text/plain');
    res.end('Hello world!');  // send the response body, no next chaining
}

// order is important when registering handlers
app.use(logger);
app.use(helloWorld);

// If we wanted the response to only work when user navigates to
// path /hello, we could have used:
//  app.use('/hello', helloWorld);
app.listen(8000);

module.exports = app;  // optional, but useful to load module for tests
</code></pre><p>If this is in a file server.js, we can run it with &rsquo;node server&rsquo; and access it at
http://localhost:8000</p><h1 id=express-web-framework>Express web framework</h1><p><a href=http://expressjs.com/>Express</a> is a node web framework built on top of Connect.
Here is the same server as before written using Express:</p><pre><code>#!javascript
var express = require('express');
var app = express();

app.use(function(req, res, next) {
   console.log(req.method, req.url);
   next();  // chain to next handler

});
// We can use app.use or specify a verb like get or post...
app.get('/hello', function(req, res) {
    // res.send will set Content-Type automatically, but you can 
    // force JSON with res.json(). You can include an initial optional
    // first argument for the status code.
    res.send('Hello world!'); 
});
app.listen(8000);
module.exports = app;
</code></pre><p>Request objects have methods to retrieve parameters, POST bodies, cookies,
etc, while the response objects have methods to set the status code, cookies,
headers, and do redirects.</p><hr><ul class=pager><li class=previous><a href=/post/zite-replacement-7/ data-toggle=tooltip data-placement=top title="Building a Zite Replacement (Part 7)">&larr;
Previous Post</a></li><li class=next><a href=/post/zite-replacement-8/ data-toggle=tooltip data-placement=top title="Building a Zite Replacement (Part 8)">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>SECTIONS</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/data-science title=data-science>data-science</a>
<a href=/tags/jupyter title=jupyter>jupyter</a>
<a href=/tags/management title=management>management</a>
<a href=/tags/pandas title=pandas>pandas</a>
<a href=/tags/programming title=programming>programming</a>
<a href=/tags/psychology title=psychology>psychology</a>
<a href=/tags/python title=python>python</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://snarky.ca/author/brett/>Brett Cannon</a></li><li><a target=_blank href=http://journal.stuffwithstuff.com/>Bob Nystrom</a></li></ul></section></div></div></div></article><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=https://utteranc.es/client.js repo=gramster/gramster.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=https://twitter.com/gramnix><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/gramster><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/grahamwheeler><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/968133><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Graham Wheeler's Random Forest"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Graham Wheeler's Random Forest 2022<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(null,e)},!1),i.parentNode.insertBefore(n,i)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,a=$(_containerSelector),r=a.find("h1,h2,h3,h4,h5,h6");return $(e).html(""),r.each(function(){t=$(this).prop("tagName").toLowerCase(),o="#"+$(this).prop("id"),n=$(this).text(),i=$('<a href="'+o+'" rel="nofollow">'+n+"</a>"),s=$('<li class="'+t+'_nav"></li>').append(i),$(e).append(s)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>