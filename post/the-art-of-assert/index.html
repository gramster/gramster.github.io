<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Graham Wheeler's Random Forest"><meta property="og:type" content="article"><meta property="og:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta property="twitter:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta name=title content="The Art of Assert"><meta property="og:title" content="The Art of Assert"><meta property="twitter:title" content="The Art of Assert"><meta name=description content="Thoughts on technology, management and math by Graham Wheeler"><meta property="og:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:card" content="summary"><meta name=keyword content="Management, Psychology, Data Science, Mathematics, Software Engineering"><link rel="shortcut icon" href=/img/favicon.ico><title>The Art of Assert-Graham Wheeler's Random Forest</title><link rel=canonical href=/post/the-art-of-assert/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Graham Wheeler's Random Forest</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/top/books/>BOOKS</a></li><li><a href=/top/archive/>ARCHIVE</a></li><li><a href=/top/about/>ABOUT</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/forest.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>The Art of Assert</h1><h2 class=subheading></h2><span class=meta>Posted by
Graham Wheeler
on
Friday, May 2, 2008</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p><em>&ldquo;Assertions are the only reliable form of program documentation&rdquo;</em>
(Charles Hoare)</p><p>While I wait for the next release of Live Search for Mobile, I will fill
in the time with some posts on tricks I have used in the dim and distant
past, before I became a mostly C# programmer. I love C#, but I really
don&rsquo;t like the way the C/C++ preprocessor was not included. While
preprocessors can be abused, they are also extremely useful (think of
__FILE__ and __LINE__, just for starters).</p><p>In particular, the preprocessor in C and C++ provides a very flexible
assertion mechanism that is much more useful then System.Diagnostics.
I&rsquo;d like to cover some useful ways of using assertions in C and C++. Of
course if you&rsquo;re an Eiffel programmer, you can probably stop reading ;-)</p><p>In the code below, I will assume the existence of a library function
<strong>HandleAssert(char* message</strong>), which does appropriate assertion
handling (for example, in a GUI app it might pop up a message box,
display the message, and give a Continue/Abort/Debug choice).</p><p>Obviously, the first thing we need is a basic ASSERT macro:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#ifdef DEBUG
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#define ASSERT(condition, message)     do { if (!(condition)) HandleAssert(message); } while (0)
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#define ASSERT(condition, message)
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span></code></pre></div><p>The first rule of asserts is, of course, never put them in production
code, hence the DEBUG conditional. The use of a do/while above
eliminates any possible dangling else issues that might otherwise crop
up if for some weird reason you put your ASSERTs in if statements.</p><p>The above is often the only form of ASSERT that most C/C++ programmers
encounter. But there are quite a few useful variants on the idea.
Sometimes, just an alias is already a useful distinction:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#define PRECONDITION(condition, message)     ASSERT(condition, message)
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#define POSTCONDITION(condition, message)    ASSERT(condition, message)
</span></span></span></code></pre></div><p>It can be useful to be able to define code that only exists in
assertional builds:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#if DEBUG
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#define ASSERTIONAL(code)      code
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#define ASSERTIONAL(code)
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span></code></pre></div><p>Putting all of the above in an example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>AdvanceIndex</span>(<span style=color:#8be9fd>int</span> index)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    ASSERTIONAL(<span style=color:#8be9fd>int</span> save_index <span style=color:#ff79c6>=</span> index);
</span></span><span style=display:flex><span>    PRECONDITION(index <span style=color:#ff79c6>&gt;=</span> <span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#34;Index can&#39;t be negative&#34;</span>);
</span></span><span style=display:flex><span>    ....
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    POSTCONDITION(index <span style=color:#ff79c6>&gt;</span> save_index, <span style=color:#f1fa8c>&#34;Index must advance&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> index;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>If we have class invariants, it is useful to define these as methods in
the class that we can call from our asserts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>foo</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#ff79c6>#if DEBUG
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>   <span style=color:#8be9fd>bool</span> <span style=color:#50fa7b>invariant</span>() { ... }
</span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>}
</span></span></code></pre></div><p>During early development, we could confine ourselves to DEBUG builds. In
this case we may want to skip over handling of bad input, etc. We can do
this safely using simplifying assumptions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#if DEBUG
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#define SIMPLIFYING_ASSUMPTION(condition,  explanation)      ASSERT(condition, explanation)
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#else
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#error SIMPLIFYING_ASSUMPTION not allowed in&gt; release code
</span></span></span><span style=display:flex><span><span style=color:#ff79c6>#endif
</span></span></span></code></pre></div><p>For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>Insert</span>(node<span style=color:#ff79c6>*</span> n)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    PRECONDITION(n <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> invariant(), <span style=color:#f1fa8c>&#34;Can&#39;t insert null&#34;</span>);
</span></span><span style=display:flex><span>    SIMPLIFYING_ASSUMPTION(find(n) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>, <span style=color:#f1fa8c>&#34;Not handling re-insertion of existing node yet&#34;</span>);
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    POSTCONDITION(find(n) <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span> <span style=color:#ff79c6>&amp;&amp;</span> invariant(), <span style=color:#f1fa8c>&#34;Node must be inserted&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Note, when writing unit tests for code that has pre- and
post-conditions, you should be striving to write tests that pass the
precondition but fail the postcondition. Thus assertions can provide
very useful test case selection guidance. Pre- and post-conditions also
tend to be more stable than the code inside methods, reduce the need to
examine the internal code, and, for the hard-core, support proving
correctness.</p><p>Sometimes we may find it useful to always fire the assert:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#define UNREACHABLE(why)      ASSERT(0, why)
</span></span></span></code></pre></div><p>We can have compile-time assertions on simple expressions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#define COMPILE_TIME_CHECK(b)    extern int dummy[(b) ? 1: -1]
</span></span></span></code></pre></div><p>As you can see from all of this, the lowly ASSERT can be quite flexible!</p><hr><ul class=pager><li class=previous><a href=/post/last-day-on-live-search-for-mobile/ data-toggle=tooltip data-placement=top title="Last Day on Live Search for Mobile">&larr;
Previous Post</a></li><li class=next><a href=/post/cute-math-curiosity/ data-toggle=tooltip data-placement=top title="Cute Math Curiosity">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>SECTIONS</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/data-science title=data-science>data-science</a>
<a href=/tags/jupyter title=jupyter>jupyter</a>
<a href=/tags/management title=management>management</a>
<a href=/tags/pandas title=pandas>pandas</a>
<a href=/tags/programming title=programming>programming</a>
<a href=/tags/psychology title=psychology>psychology</a>
<a href=/tags/python title=python>python</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://snarky.ca/author/brett/>Brett Cannon</a></li><li><a target=_blank href=http://journal.stuffwithstuff.com/>Bob Nystrom</a></li></ul></section></div></div></div></article><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=https://utteranc.es/client.js repo=gramster/gramster.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target=_blank href=https://github.com/gramster><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/grahamwheeler><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/968133><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Graham Wheeler's Random Forest"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Graham Wheeler's Random Forest 2022<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(i,t){var n=document,s="script",e=n.createElement(s),o=n.getElementsByTagName(s)[0];e.src=i,t&&e.addEventListener("load",function(e){t(null,e)},!1),o.parentNode.insertBefore(e,o)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(''),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>