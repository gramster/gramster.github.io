<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Graham Wheeler's Random Forest"><meta property="og:type" content="article"><meta property="og:image" content="http://www.grahamwheeler.com/img/forest.jpg"><meta property="twitter:image" content="http://www.grahamwheeler.com/img/forest.jpg"><meta name=title content="Building a Zite Replacement (Part 10)"><meta property="og:title" content="Building a Zite Replacement (Part 10)"><meta property="twitter:title" content="Building a Zite Replacement (Part 10)"><meta name=description content="Thoughts on technology, management and math by Graham Wheeler"><meta property="og:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:card" content="summary"><meta name=keyword content="Management, Psychology, Data Science, Mathematics, Software Engineering"><link rel="shortcut icon" href=/img/favicon.ico><title>Building a Zite Replacement (Part 10)-Graham Wheeler's Random Forest</title><link rel=canonical href=/post/zite-replacement-10/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Graham Wheeler's Random Forest</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/top/books/>BOOKS</a></li><li><a href=/top/archive/>ARCHIVE</a></li><li><a href=/top/about/>ABOUT</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/forest.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Building a Zite Replacement (Part 10)</h1><h2 class=subheading></h2><span class=meta>Posted by
Graham Wheeler
on
Saturday, November 7, 2015</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>I&rsquo;ve spent the past few days refining the web server, largely for diagnostic
purposes, so it can replace the old TkInter app. I can seen articles for
categories or feeds, their rank, and detailed information on why they
received particular categories and ranks. This has enabled me to improve
the categorization and ranking algorithms. I&rsquo;m at a point now where I
feel I need a lot more sources than the ~4000 I have right now, as well as
more categories. The latter is more complex and will take me back to some
of my earlier explorations in clustering, etc. The former largely involves
mining more of the web to find useful sites.</p><p>Currently doing a pull of the ~4000 sites takes several minutes on my
low-power server. If I want to scale to 10x or more polling is not ideal.
So another change I have needed is to move to a push model. Thankfully
that&rsquo;s possible, through the use of the <a href=https://en.wikipedia.org/wiki/PubSubHubbub>PubSubHubbub</a> (aka PuSH). This is a Google-designed
system whereby publishers can
push notifications of updates to central servers that in turn support
subscriptions on clients for receiving notifications. There are commercial
services for this (<a href=http://superfeedr.com>Superfeedr</a> seem&rsquo;s to be the main
player here) but there is also a publicly accessible server run by Google.</p><p>Using this is fairly straightforward. Here is a simple Python script for
subscribing or unsubscribing. You pass in a command (subscribe/unsubscribe), an
RSS feed URL you want notfications for, and a callback URL that the PuSH
server will call back to, both to confirm the subscription and to send
notifications to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6272a4>#!python</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> sys
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> urllib
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> urllib2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> __name__ <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(sys<span style=color:#ff79c6>.</span>argv) <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>4</span>:
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>print</span> <span style=color:#f1fa8c>&#34;Usage: python pubsub.py (subscribe|unsubscribe) &lt;feed&gt; &lt;callback&gt;&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>    params <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;hub.mode&#39;</span>: sys<span style=color:#ff79c6>.</span>argv[<span style=color:#bd93f9>1</span>],
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;hub.verify&#39;</span>: <span style=color:#f1fa8c>&#39;sync&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;hub.callback&#39;</span>: sys<span style=color:#ff79c6>.</span>argv[<span style=color:#bd93f9>3</span>],
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#39;hub.topic&#39;</span>: sys<span style=color:#ff79c6>.</span>argv[<span style=color:#bd93f9>2</span>],
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>try</span>:
</span></span><span style=display:flex><span>        request <span style=color:#ff79c6>=</span> urllib2<span style=color:#ff79c6>.</span>Request(
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;https://pubsubhubbub.appspot.com&#34;</span>,  <span style=color:#6272a4># Google server</span>
</span></span><span style=display:flex><span>            data<span style=color:#ff79c6>=</span>urllib<span style=color:#ff79c6>.</span>urlencode(params))
</span></span><span style=display:flex><span>        urllib2<span style=color:#ff79c6>.</span>urlopen(request)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>except</span> Exception <span style=color:#ff79c6>as</span> e:
</span></span><span style=display:flex><span>      <span style=color:#8be9fd;font-style:italic>print</span> <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c> failed: </span><span style=color:#f1fa8c>%s</span><span style=color:#f1fa8c>&#34; % (command, str(e))</span>
</span></span></code></pre></div><p>You can include a verification token too in the params, and your callback
server can verify that to make sure that you did the subscribe request and
not someone else.</p><p>The other part of this is the callback server. In my case I want to just fold
this in to my node server, so I added this code in my routes/index.js file. For
now I&rsquo;m just writing the updates to a file. My callback URL is hostname/pubsub:</p><pre><code>#!javascript
router.get('/pubsub', function(req, res) {
  if (req.query['hub.challenge']) {
    // Subscription verification request; send back challenge
    res.send(req.query['hub.challenge']);
  } else {
    // Update notification
    res.send('');
    fs.appendFile('pubsub.txt', JSON.stringify(req.body) + '\n',
      function (err) {
      }
    );
  }
});
</code></pre><p>You can find full details of the PuSH spec <a href=https://pubsubhubbub.googlecode.com/git/pubsubhubbub-core-0.4.html>here</a>.</p><hr><ul class=pager><li class=previous><a href=/post/zite-replacement-9/ data-toggle=tooltip data-placement=top title="Building a Zite Replacement (Part 9)">&larr;
Previous Post</a></li><li class=next><a href=/post/using-jupyter-as-a-music-notebook/ data-toggle=tooltip data-placement=top title="Using Jupyter as a Music Notebook">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>SECTIONS</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/data-science title=data-science>data-science</a>
<a href=/tags/jupyter title=jupyter>jupyter</a>
<a href=/tags/management title=management>management</a>
<a href=/tags/pandas title=pandas>pandas</a>
<a href=/tags/programming title=programming>programming</a>
<a href=/tags/psychology title=psychology>psychology</a>
<a href=/tags/python title=python>python</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://snarky.ca/author/brett/>Brett Cannon</a></li><li><a target=_blank href=http://journal.stuffwithstuff.com/>Bob Nystrom</a></li></ul></section></div></div></div></article><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=https://utteranc.es/client.js repo=gramster/gramw.github.io issue-term=title theme=github-light crossorigin=anonymous async></script><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a target=_blank href=https://github.com/gramster><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/grahamwheeler><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/968133><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Graham Wheeler's Random Forest"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Graham Wheeler's Random Forest 2022<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(i,t){var n=document,s="script",e=n.createElement(s),o=n.getElementsByTagName(s)[0];e.src=i,t&&e.addEventListener("load",function(e){t(null,e)},!1),o.parentNode.insertBefore(e,o)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(''),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>