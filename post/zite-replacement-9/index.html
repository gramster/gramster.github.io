<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:site_name" content="Graham Wheeler's Random Forest"><meta property="og:type" content="article"><meta property="og:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta property="twitter:image" content="https://www.grahamwheeler.com/img/forest.jpg"><meta name=title content="Building a Zite Replacement (Part 9)"><meta property="og:title" content="Building a Zite Replacement (Part 9)"><meta property="twitter:title" content="Building a Zite Replacement (Part 9)"><meta name=description content="Thoughts on technology, management and math by Graham Wheeler"><meta property="og:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:description" content="Thoughts on technology, management and math by Graham Wheeler"><meta property="twitter:card" content="summary"><meta name=keyword content="Management, Psychology, Data Science, Mathematics, Software Engineering"><link rel="shortcut icon" href=/img/favicon.ico><title>Building a Zite Replacement (Part 9)-Graham Wheeler's Random Forest</title><link rel=canonical href=/post/zite-replacement-9/><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/hugo-theme-cleanwhite.min.css><link rel=stylesheet href=/css/zanshang.css><link href=https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome@5.15.1/css/all.css rel=stylesheet type=text/css><script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js></script>
<script src=/js/hux-blog.min.js></script></head><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class=container-fluid><div class="navbar-header page-scroll"><button type=button class=navbar-toggle>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button>
<a class=navbar-brand href=/>Graham Wheeler's Random Forest</a></div><div id=huxblog_navbar><div class=navbar-collapse><ul class="nav navbar-nav navbar-right"><li><a href=/>All Posts</a></li><li><a href=/top/books/>BOOKS</a></li><li><a href=/top/archive/>ARCHIVE</a></li><li><a href=/top/about/>ABOUT</a></li></ul></div></div></div></nav><script>var $body=document.body,$toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic);function handleMagic(){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}</script><style type=text/css>header.intro-header{background-image:url(/img/forest.jpg)}</style><header class=intro-header><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><div class=tags></div><h1>Building a Zite Replacement (Part 9)</h1><h2 class=subheading></h2><span class=meta>Posted by
Graham Wheeler
on
Sunday, November 1, 2015</span></div></div></div></div></header><article><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container"><p>Well, I hope you&rsquo;ve all brushed your teeth after all that Halloween candy.</p><p>Today I&rsquo;m going to show how I build a simple web server to view my feed
articles using node.js and Express, along with MongoDB. I have a simple
category classifier which finds the best Jacard similarity (described earlier)
to a set of category exemplars (i.e. &lsquo;pseudo-articles&rsquo; for a category
containing just key words that are typical for that category). It needs a
lot of tuning and the earlier tkInter program was meant for that but tkInter
proved to have problems. So time to use some more modern techologies!</p><p>I gave an overview of node in an earlier article; if you have no familiarity
with node you should go read that first. I&rsquo;m not going to go into
much detail here about installation, etc; if you want to try this you can
easily install node for your platform. We&rsquo;re going to generate a scaffold
Express app with a generator, so we need to install that along with its
dependencies:</p><pre><code>#!bash
npm install -g express-generator
</code></pre><p>and then generate the skeleton in a &lsquo;server&rsquo; subdirectory:</p><pre><code>#!bash
express server
cd server
</code></pre><p>This skeleton will include a package.json file; we need to edit that and
add these to the end of the dependencies section (make sure to add a comma
on the previous last line in the dependencies):</p><pre><code>#!javascript
&quot;mongodb&quot;: &quot;~2.0.33&quot;,
&quot;monk&quot;: &quot;~1.0.1&quot;
</code></pre><p>Then install the dependencies:</p><pre><code>#!bash
cd server
npm install
</code></pre><p>Although we&rsquo;ll be adding some more and need to rerun this again later.</p><p>We need to tell node to use our database. To do that, we edit app.js
and before the line that says:</p><pre><code>#!javascript
var routes = require('./routes/index');
</code></pre><p>we add:</p><pre><code>#!javascript
var mongo = require('mongodb');
var monk = require('monk');
var db = monk('localhost:27017/feed_database');
</code></pre><p>(I called my MongoDB feed_database; you would need to use a different name
for a different database).</p><p>To make the database accessible to our page handler, before the line that says:</p><pre><code>#!javascript
app.use('/', routes);
</code></pre><p>we add:</p><pre><code>#!javascript
app.use(function(req,res,next){
    req.db = db;
    next();
});
</code></pre><p>This will add a property &lsquo;db&rsquo; to each request that points to out database so
each request handler has easy access to the database.</p><p>Our server will use the local URL /categories for a page with the
list of categories that have articles. Each of these will in turn link
to an /articles page which will show the titles of articles for that
category, and link back to the source. To set up the routes we need to edit
routes/index.js, and add our additions (before the modules.exports
line at the end):</p><pre><code>#!javascript
/* GET categories page. */
router.get('/categories', function(req, res) {
    var db = req.db;
    var collection = db.get('articles');
    collection.distinct('classification', function(e, docs) {
        res.render('categories', {
            &quot;categories&quot;: docs
        });
    });
});

/* GET articles page. */
router.get('/articles', function(req, res) {
    var db = req.db;
    var collection = db.get('articles');
    collection.find({'classification': req.query.category},
        function(e, docs) {
            res.render('articles', {
                &quot;category&quot;: req.query.category,
                &quot;articles&quot;: docs
            });
        }
    );
});
</code></pre><p>The /categories page router finds all distinct values for the &lsquo;classification&rsquo;
field (which I use to put my categorization of an article, as they already
have a &lsquo;Category&rsquo; field which is part of RSS). It then renders a page using
a &lsquo;categories&rsquo; template and passes the template an object with a &lsquo;categories&rsquo;
property which has the resulting document returned by the database. The
template engine is Jade which Express uses by default.</p><p>We&rsquo;ll look at the /article page route in a moment; first look at the
template for the categories page which we create in file views/categories.jade:</p><pre><code>#!text
extends layout

block content
  h1.
    Categories
  ul
    each category in categories
      li
        a(href=&quot;articles?category=#{category}&quot;)= category
</code></pre><p>This is pretty simple. Jade uses indentation for hierarchy so that is important
to get correct. We create a heading and a list, with each list entry
being a category name in the form of a link to the /articles page with a
query parameter for the category. Now the /articles router should be easy
to understand. We find all documents in the database that have the same
classification as was specified in the category query parameter in the request
URL, and render the page using the article template, passing that template
the article list and category name. That template looks like:</p><pre><code>#!text
extends layout

block content
  h1.
    Articles for #{category}
  ul
    each article in articles
      li
        a(href=&quot;#{article.link}&quot;)= article.title
</code></pre><p>Very similar to the category one except we put article titles in the list and
our links refer to the original article links, so clicking on a title will
take us to the web page for that article. Pretty simple!</p><p>Now we can run this:</p><pre><code>#!bash
npm start
</code></pre><p>and navigate to http://localhost:3000/categories to see what we might want to
read!</p><hr><ul class=pager><li class=previous><a href=/post/zite-replacement-8/ data-toggle=tooltip data-placement=top title="Building a Zite Replacement (Part 8)">&larr;
Previous Post</a></li><li class=next><a href=/post/zite-replacement-10/ data-toggle=tooltip data-placement=top title="Building a Zite Replacement (Part 10)">Next
Post &rarr;</a></li></ul></div><div class="col-lg-2 col-lg-offset-0
visible-lg-block
sidebar-container
catalog-container"><div class=side-catalog><hr class="hidden-sm hidden-xs"><h5><a class=catalog-toggle href=#>SECTIONS</a></h5><ul class=catalog-body></ul></div></div><div class="col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container"><section><hr class="hidden-sm hidden-xs"><h5><a href=/tags/>FEATURED TAGS</a></h5><div class=tags><a href=/tags/data-science title=data-science>data-science</a>
<a href=/tags/jupyter title=jupyter>jupyter</a>
<a href=/tags/management title=management>management</a>
<a href=/tags/pandas title=pandas>pandas</a>
<a href=/tags/programming title=programming>programming</a>
<a href=/tags/psychology title=psychology>psychology</a>
<a href=/tags/python title=python>python</a></div></section><section><hr><h5>FRIENDS</h5><ul class=list-inline><li><a target=_blank href=https://snarky.ca/author/brett/>Brett Cannon</a></li><li><a target=_blank href=http://journal.stuffwithstuff.com/>Bob Nystrom</a></li></ul></section></div></div></div></article><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src=https://utteranc.es/client.js repo=gramster/gramster.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href=https://twitter.com/gramnix><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://github.com/gramster><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://www.linkedin.com/in/grahamwheeler><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a target=_blank href=https://stackoverflow.com/users/968133><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i></span></a></li><li><a href rel=alternate type=application/rss+xml title="Graham Wheeler's Random Forest"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; Graham Wheeler's Random Forest 2022<br><a href=https://themes.gohugo.io/hugo-theme-cleanwhite>CleanWhite Hugo Theme</a> by <a href=https://zhaohuabing.com>Huabing</a> |
<iframe style=margin-left:2px;margin-bottom:-5px frameborder=0 scrolling=0 width=100px height=20px src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true"></iframe></p></div></div></div></footer><script>function loadAsync(i,t){var n=document,s="script",e=n.createElement(s),o=n.getElementsByTagName(s)[0];e.src=i,t&&e.addEventListener("load",function(e){t(null,e)},!1),o.parentNode.insertBefore(e,o)}</script><script>$("#tag_cloud").length!==0&&loadAsync("/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js",function(){var e=document.querySelector("nav");e&&FastClick.attach(e)})</script><script type=text/javascript>function generateCatalog(e){_containerSelector="div.post-container";var t,n,s,o,i,r=$(_containerSelector),a=r.find("h1,h2,h3,h4,h5,h6");return $(e).html(''),a.each(function(){n=$(this).prop("tagName").toLowerCase(),i="#"+$(this).prop("id"),s=$(this).text(),t=$('<a href="'+i+'" rel="nofollow">'+s+"</a>"),o=$('<li class="'+n+'_nav"></li>').append(t),$(e).append(o)}),!0}generateCatalog(".catalog-body"),$(".catalog-toggle").click(function(e){e.preventDefault(),$(".side-catalog").toggleClass("fold")}),loadAsync("/js/jquery.nav.js",function(){$(".catalog-body").onePageNav({currentClass:"active",changeHash:!1,easing:"swing",filter:"",scrollSpeed:700,scrollOffset:0,scrollThreshold:.2,begin:null,end:null,scrollChange:null,padding:80})})</script></body></html>